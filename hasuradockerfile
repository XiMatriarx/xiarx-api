FROM hasura/graphql-engine:v2.37.0 AS hasura

ARG PG_DATABASE_URL
ARG HASURA_GRAPHQL_ACTION_CODEGEN_OUTPUT_DIR
ARG HASURA_GRAPHQL_ACTION_CODEGEN_URI
ARG HASURA_GRAPHQL_ACTIONS_CODEGEN_FRAMEWORK
ARG HASURA_GRAPHQL_ACTIONS_HANDLER_WEBHOOK_BASEURL
ARG HASURA_GRAPHQL_ACTIONS_KIND
ARG HASURA_GRAPHQL_ADMIN_SECRET=secret
ARG HASURA_GRAPHQL_ADMIN_SECRETS
ARG HASURA_GRAPHQL_API_PATHS_CONFIG
ARG HASURA_GRAPHQL_API_PATHS_GRAPHQL
ARG HASURA_GRAPHQL_API_PATHS_PG_DUMP
ARG HASURA_GRAPHQL_API_PATHS_QUERY
ARG HASURA_GRAPHQL_API_PATHS_VERSION
ARG HASURA_GRAPHQL_AUTH_HOOK
ARG HASURA_GRAPHQL_CERTIFICATE_AUTHORITY
ARG HASURA_GRAPHQL_CONSOLE_ASSETS_DIR
ARG HASURA_GRAPHQL_DEV_MODE=false
ARG HASURA_GRAPHQL_ENABLE_CONSOLE=false
ARG HASURA_GRAPHQL_ENABLED_LOG_TYPES=startup, http-log, webhook-log, websocket-log, query-log
ARG HASURA_GRAPHQL_ENDPOINT
ARG HASURA_GRAPHQL_INSECURE_SKIP_TLS_VERIFY
ARG HASURA_GRAPHQL_METADATA_DATABASE_URL
ARG HASURA_GRAPHQL_METADATA_DEFAULTS
ARG HASURA_GRAPHQL_METADATA_DIRECTORY
ARG HASURA_GRAPHQL_MIGRATIONS_DIRECTORY
ARG HASURA_GRAPHQL_SEEDS_DIRECTORY
ARG HASURA_GRAPHQL_VERSION
ARG PORT=80

ENV DATABASE_URL=${DATABASE_URL}
ENV HASURA_GRAPHQL_ACTION_CODEGEN_OUTPUT_DIR=${HASURA_GRAPHQL_ACTION_CODEGEN_OUTPUT_DIR}
ENV HASURA_GRAPHQL_ACTION_CODEGEN_URI=${HASURA_GRAPHQL_ACTION_CODEGEN_URI}
ENV HASURA_GRAPHQL_ACTIONS_CODEGEN_FRAMEWORK=${HASURA_GRAPHQL_ACTIONS_CODEGEN_FRAMEWORK}
ENV HASURA_GRAPHQL_ACTIONS_HANDLER_WEBHOOK_BASEURL=${HASURA_GRAPHQL_ACTIONS_HANDLER_WEBHOOK_BASEURL}
ENV HASURA_GRAPHQL_ACTIONS_KIND=${HASURA_GRAPHQL_ACTIONS_KIND}
ENV HASURA_GRAPHQL_ADMIN_SECRET=${HASURA_GRAPHQL_ADMIN_SECRET}
ENV HASURA_GRAPHQL_ADMIN_SECRETS=${HASURA_GRAPHQL_ADMIN_SECRETS}
ENV HASURA_GRAPHQL_API_PATHS_CONFIG=${HASURA_GRAPHQL_API_PATHS_CONFIG}
ENV HASURA_GRAPHQL_API_PATHS_GRAPHQL=${HASURA_GRAPHQL_API_PATHS_GRAPHQL}
ENV HASURA_GRAPHQL_API_PATHS_PG_DUMP=${HASURA_GRAPHQL_API_PATHS_PG_DUMP}
ENV HASURA_GRAPHQL_API_PATHS_QUERY=${HASURA_GRAPHQL_API_PATHS_QUERY}
ENV HASURA_GRAPHQL_API_PATHS_VERSION=${HASURA_GRAPHQL_API_PATHS_VERSION}
ENV HASURA_GRAPHQL_AUTH_HOOK=${HASURA_GRAPHQL_AUTH_HOOK}
ENV HASURA_GRAPHQL_CERTIFICATE_AUTHORITY=${HASURA_GRAPHQL_CERTIFICATE_AUTHORITY}
ENV HASURA_GRAPHQL_CONSOLE_ASSETS_DIR=${HASURA_GRAPHQL_CONSOLE_ASSETS_DIR}
ENV HASURA_GRAPHQL_DEV_MODE=${HASURA_GRAPHQL_DEV_MODE}
ENV HASURA_GRAPHQL_ENABLE_CONSOLE=${HASURA_GRAPHQL_ENABLE_CONSOLE}
ENV HASURA_GRAPHQL_ENABLED_LOG_TYPES=${HASURA_GRAPHQL_ENABLED_LOG_TYPES}
ENV HASURA_GRAPHQL_ENDPOINT=${HASURA_GRAPHQL_ENDPOINT}
ENV HASURA_GRAPHQL_INSECURE_SKIP_TLS_VERIFY=${HASURA_GRAPHQL_INSECURE_SKIP_TLS_VERIFY}
ENV HASURA_GRAPHQL_METADATA_DATABASE_URL=${HASURA_GRAPHQL_METADATA_DATABASE_URL}
ENV HASURA_GRAPHQL_METADATA_DEFAULTS=${HASURA_GRAPHQL_METADATA_DEFAULTS}
ENV HASURA_GRAPHQL_METADATA_DIRECTORY=${HASURA_GRAPHQL_METADATA_DIRECTORY}
ENV HASURA_GRAPHQL_MIGRATIONS_DIRECTORY=${HASURA_GRAPHQL_MIGRATIONS_DIRECTORY}
ENV HASURA_GRAPHQL_SEEDS_DIRECTORY=${HASURA_GRAPHQL_SEEDS_DIRECTORY}
ENV HASURA_GRAPHQL_VERSION=${HASURA_GRAPHQL_VERSION}

COPY entrypoint.sh entrypoint.sh

EXPOSE ${PORT}

CMD ["entrypoint.sh"]
